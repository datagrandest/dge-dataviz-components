<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <title>DataGrandEst dataviz components - Test</title>
    <link rel='icon' type='image/png' href='favicon.png'>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css">

    <script src="dge-components/jquery/jquery-3.6.0.slim.min.js"></script>
    <script src="dge-components/popper/popper.min.js"></script>
    <script src="dge-components/bootstrap/js/bootstrap.min.js"></script>

    <script defer src='dge-components/index.js'></script>
    <!-- <script defer src='dge-components/dataviz-v4/dge-figure.js'></script> -->
    <!-- <script defer src='dge-components/dataviz-v4/dge-chart.js'></script> -->
</head>

<body>

    <div class="container-fluid my-3">
        <div class="row">
            <div class="col-12 col-lg-6">
                <dge-chart 
                    id="dge-chart-6" 
                    title="Chiffres clés des Dépenses" 
                    attribution="GéoGrandEst|https://www.geograndest.fr" 
                    max="10000" 
                    api="csv" 
                    url="./data/ca-region.csv" 
                    fields="BGT_MTREAL,BGT_CONTNAT_LABEL,BGT_CODRD,BGT_ANNEE" 
                    groupby="BGT_CONTNAT_LABEL"
                    orderby="mtreal"
                    where="BGT_CODRD = 'dépense' AND BGT_ANNEE = 2020" 
                    x="BGT_CONTNAT_LABEL" 
                    y="SUM(BGT_MTREAL),mtreal" 
                    chart="doughnut"
                    labels="value,100000000" />
            </div>
        </div>
    </div>
</body>

</html>


SELECT BGT_MTREAL AS BGT_MTREAL, BGT_CONTNAT_LABEL AS BGT_CONTNAT_LABEL, BGT_CODRD AS BGT_CODRD, BGT_ANNEE AS BGT_ANNEE, BGT_CONTNAT_LABEL AS BGT_CONTNAT_LABEL FROM ? WHERE BGT_CODRD = 'dépense' AND BGT_ANNEE = '2020' 

SELECT *, SUM(BGT_MTREAL) AS mtreal FROM ? WHERE 1 GROUP BY BGT_CONTNAT_LABEL 